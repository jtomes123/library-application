@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.FluentUI.AspNetCore.Components.Icons.Filled
@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject IConfiguration Configuration

<FluentLayout>
    <FluentHeader>
        <FluentStack Orientation="Orientation.Horizontal" VerticalAlignment="VerticalAlignment.Center">
            LibraryApplication
            <FluentSpacer />
            <CascadingAuthenticationState>
                <AuthorizeView>
                    <Authorized>
                        <FluentPersona Name="@(context.User.Identity?.Name!)"
                                       StatusTitle="Signed In"
                                       Image="@(new Icons.Regular.Size48.Person().ToDataUri(size: "25px", color: "white"))"
                                       ImageSize="36px">
                        </FluentPersona>
                        <form method="post" action="/logout">
                            <FluentButton IconEnd="@(new Size20.SignOut())"
                                          Appearance="Appearance.Accent" Type="ButtonType.Submit" />
                        </form>
                    </Authorized>
                    <NotAuthorized>
                        @if (!string.IsNullOrWhiteSpace(Configuration["Authentication:Google:ClientId"]))
                        {
                            <form method="get" action="/login">
                                <FluentButton IconEnd="@(new Size20.PersonLock())"
                                              Appearance="Appearance.Accent" Type="ButtonType.Submit"/>
                            </form>
                        }
                        @if (!string.IsNullOrWhiteSpace(Configuration["Authentication:Debug"]))
                        {
                            <form method="get" action="/debugLogin/user">
                                <FluentButton Appearance="Appearance.Accent" Type="ButtonType.Submit">
                                    Debug Login (User)
                                </FluentButton>
                            </form>
                            <form method="get" action="/debugLogin/admin">
                                <FluentButton Appearance="Appearance.Accent" Type="ButtonType.Submit">
                                    Debug Login (Admin)
                                </FluentButton>
                            </form>
                        }
                    </NotAuthorized>
                </AuthorizeView>
            </CascadingAuthenticationState>
        </FluentStack>
    </FluentHeader>
    <FluentStack Class="main" Orientation="Orientation.Horizontal" Width="100%">
        <NavMenu/>
        <FluentBodyContent Class="body-content">
            <div class="content">
                @Body
            </div>
        </FluentBodyContent>
        <FluentToastProvider MaxToastCount="10" @rendermode="InteractiveServer" />
    </FluentStack>
    <FluentFooter>
        Developed by Jakub Tomeš
        <FluentSpacer />
        <a href="https://github.com/jtomes123/library-application">Git</a>
    </FluentFooter>
</FluentLayout>

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>

@code
{
    private void LoginDebugAdmin() =>
        Navigation.NavigateTo($"/debugLogin/admin", forceLoad: true);
    
    private void LoginDebugUser() =>
        Navigation.NavigateTo($"/debugLogin/user", forceLoad: true);
}
